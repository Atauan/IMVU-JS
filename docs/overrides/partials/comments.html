{% if page.meta.comments %}
<h2 id="__comments">{{ lang.t("meta.comments") }}</h2>
<!-- Insert generated snippet here -->
<script src="https://giscus.app/client.js"
        data-repo="dhkatz/imvu.js"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxNzc0OTQ4Mzg="
        data-category="[ENTER CATEGORY NAME HERE]"
        data-category-id="[ENTER CATEGORY ID HERE]"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>

<!-- Synchronize Giscus theme with palette -->
<script>
    /**
     * @callback __md_get
     * @template T
     * @param {string} key
     * @returns T
     */

	const giscus = document.querySelector('script[src*=giscus]');

	/* Set palette on initial load */
	const palette = __md_get('__palette');
	if (palette && typeof palette.color === 'object') {
		const theme = palette.color.scheme === 'slate' ? 'dark' : 'light';
		giscus.setAttribute('data-theme', theme);
	}

	/* Register event handlers after documented loaded */
	document.addEventListener('DOMContentLoaded', function () {
		const ref = document.querySelector('[data-md-component=palette]');
		ref.addEventListener('change', function () {
			const palette = __md_get('__palette');
			if (palette && typeof palette.color === 'object') {
				const theme = palette.color.scheme === 'slate' ? 'dark' : 'light';

				/* Instruct Giscus to change theme */
				const frame = document.querySelector('.giscus-frame');
				frame.contentWindow.postMessage(
					{ giscus: { setConfig: { theme } } },
					'https://giscus.app',
				);
			}
		});
	});
</script>
{% endif %}
